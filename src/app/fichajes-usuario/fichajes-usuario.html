<div class="container animate__animated animate__fadeIn">
  <div class="header-section">
    <div class="title-group">
      <h1>Mis Fichajes</h1>
      <p class="subtitle">Historial de registros de entrada y salida</p>
    </div>

    <div class="filters">
      <mat-form-field appearance="outline">
        <mat-label>Filtrar por fecha</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          [(ngModel)]="selectedDate"
          (dateChange)="onDateChange($event)"
        />
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>

      <button
        mat-icon-button
        *ngIf="selectedDate"
        (click)="clearDate()"
        matTooltip="Limpiar filtro"
      >
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <div class="table-container mat-elevation-z2">
    <table mat-table [dataSource]="dataSource" matSort>
      <!-- Entrada Column -->
      <ng-container matColumnDef="entrada">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Entrada</th>
        <td mat-cell *matCellDef="let element">
          <div class="datetime-cell">
            <span class="date">{{ element.clock_in_at | date: 'dd/MM/yyyy' }}</span>
            <span class="time">{{ element.clock_in_at | date: 'HH:mm' }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Salida Column -->
      <ng-container matColumnDef="salida">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Salida</th>
        <td mat-cell *matCellDef="let element">
          <div *ngIf="element.clock_out_at; else noSalida" class="datetime-cell">
            <span class="date">{{ element.clock_out_at | date: 'dd/MM/yyyy' }}</span>
            <span class="time">{{ element.clock_out_at | date: 'HH:mm' }}</span>
          </div>
          <ng-template #noSalida>
            <span class="status-badge open">Sin salida</span>
          </ng-template>
        </td>
      </ng-container>

      <!-- Horas Column -->
      <ng-container matColumnDef="horas">
        <th mat-header-cell *matHeaderCellDef>Horas</th>
        <td mat-cell *matCellDef="let element">
          <span class="hours-badge">{{
            calculateHours(element.clock_in_at, element.clock_out_at)
          }}</span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="3">No hay registros para mostrar</td>
      </tr>
    </table>

    <mat-paginator
      [pageSizeOptions]="[5, 10, 20]"
      showFirstLastButtons
      aria-label="Select page of periodic elements"
    >
    </mat-paginator>
  </div>
</div>
