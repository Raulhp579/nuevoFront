<div class="contenedor animate__animated animate__fadeIn">
  <div class="body">
    <div class="welcome-row">
      <div class="header-home">
        <!--         <div class="left-space"> //ver donde poner
          @if (working) {
            <div class="status-row">
              <span class="chip chip-red">
                <span class="chip-dot"></span>
                Fichado
              </span>
            </div>
          } @else {
            <div class="status-row">
              <span class="chip chip-success">
                <span class="chip-dot"></span>
                Sin Fichar
              </span>
            </div>
          }
        </div> -->
      </div>
    </div>

    <div class="grid-home">
      <!-- Card principal -->
      @if (working) {
        <section class="card card-main">
          <div class="card-main-left">
            <div class="metric">
              <div class="metric-label">Hora de entrada</div>
              <div class="metric-value">{{ infoTime }}</div>
            </div>

            <div class="divider"></div>

            <div class="metric">
              <div class="metric-label">Tiempo trabajado</div>
              <div class="metric-value">{{ timerDisplay }}</div>
            </div>
          </div>

          <div class="card-main-right animate__animated animate__pulse">
            <div class="clock-circle">
              <mat-icon class="icono-reloj-rojo">schedule</mat-icon>
            </div>
            <button class="btn-primary-red" type="button" (click)="inOut()" [disabled]="loading()">
              @if (loading()) {
                <span class="loader"></span> Fichando...
              } @else {
                Fichar salida
              }
            </button>
          </div>
        </section>
      } @else {
        <section class="card card-main">
          <div class="card-main-left">
            <div class="metric">
              <div class="metric-label">Hora de salida</div>
              <div class="metric-value">{{ infoTime }}</div>
            </div>

            <div class="divider"></div>

            <div class="metric">
              <div class="metric-label">Tiempo trabajado</div>
              <div class="metric-value">{{ timerDisplay }}</div>
            </div>
          </div>

          <div class="card-main-right animate__animated animate__pulse reloj">
            <div class="clock-circle">
              <mat-icon class="icono-reloj-verde">schedule</mat-icon>
            </div>
            <button
              class="btn-primary-green"
              type="button"
              (click)="inOut()"
              [disabled]="loading()"
            >
              @if (loading()) {
                <span class="loader"></span> Fichando...
              } @else {
                Fichar Entrada
              }
            </button>
          </div>
        </section>
      }

      <!-- Card derecha: MAPA futuro -->
      <aside class="card card-side">
        <div class="card-head">
          <div>
            <h3 class="card-title">Ubicación</h3>
          </div>
        </div>

        <div class="map-wrap">
          <app-mapa></app-mapa>
        </div>
      </aside>

      <!-- Card abajo: últimos fichajes -->
      <section class="card card-bottom">
        <div class="card-head">
          <div>
            <h3 class="card-title">Últimos fichajes</h3>
            <div class="card-sub">Resumen rápido</div>
          </div>
          <a class="link" routerLink="/myEntries">Ver todos</a>
        </div>

        <div class="table">
          <div class="row head">
            <span>Hora entrada</span>
            <span>Hora salida</span>
            <span class="right">Duración</span>
          </div>

          @for (entry of lastEntries(); track entry.id) {
            <div class="row">
              <span>{{ entry.clock_in_at | date: 'hh:mm a' }}</span>
              <span
                >—
                {{ entry.clock_out_at ? (entry.clock_out_at | date: 'hh:mm a') : 'En curso' }}</span
              >
              <span class="right">{{
                calculateDuration(entry.clock_in_at, entry.clock_out_at)
              }}</span>
            </div>
          } @empty {
            <div class="row">
              <span colspan="3">No hay fichajes recientes.</span>
            </div>
          }
        </div>
      </section>
    </div>
  </div>
</div>
