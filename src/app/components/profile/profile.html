<div class="profile-container">
  <!-- Header / Banner -->
  <div class="profile-header">
    <div class="header-content">
      <div class="avatar-large">
        @if (user()?.name) {
          <span>{{ user()?.name?.charAt(0).toUpperCase() }}</span>
        } @else {
          <mat-icon>person</mat-icon>
        }
      </div>
      <div class="user-info">
        <h1>{{ user()?.name | titlecase }}</h1>
        <p class="role-badge">{{ user()?.role | titlecase }}</p>
      </div>
    </div>
  </div>

  <div class="profile-content">
    <!-- Columna 1: Detalles -->
    <div class="col-1">
      <mat-card class="info-card">
        <mat-card-header>
          <mat-card-title>Detalles</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="detail-item">
            <label>Email</label>
            <p>{{ user()?.email }}</p>
          </div>
          <div class="detail-item">
            <label>Miembro desde</label>
            <p>{{ user()?.created_at | date: 'mediumDate' }}</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Columna 2: Cambiar Contraseña -->
    <div class="col-2">
      <mat-card class="action-card">
        <mat-card-header>
          <mat-card-title>Cambiar Contraseña</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Contraseña actual</mat-label>
              <input matInput formControlName="current_password" type="password" />
              @if (passwordForm.get('current_password')?.hasError('required')) {
                <mat-error>Requerido</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Nueva contraseña</mat-label>
              <input matInput formControlName="new_password" type="password" />
              @if (passwordForm.get('new_password')?.hasError('minlength')) {
                <mat-error>Mínimo 8 caracteres</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Confirmar nueva contraseña</mat-label>
              <input matInput formControlName="new_password_confirmation" type="password" />
              @if (passwordForm.hasError('mismatch')) {
                <mat-error>Las contraseñas no coinciden</mat-error>
              }
            </mat-form-field>

            <button
              mat-flat-button
              color="primary"
              class="save-btn"
              type="submit"
              [disabled]="passwordForm.invalid"
            >
              Guardar Cambios
            </button>
          </form>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Columna 3: Estadísticas -->
    <div class="col-3">
      <mat-card class="stats-card">
        <mat-card-header>
          <mat-card-title>Estadísticas de Fichaje (Últimos 7 días)</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            <canvas
              baseChart
              [data]="lineChartData"
              [options]="lineChartOptions"
              [legend]="lineChartLegend"
              [type]="'line'"
            >
            </canvas>
          </div>

          <div class="mini-stats">
            @for (stat of recentStats(); track stat.date) {
              <div class="mini-stat-item">
                <mat-icon>schedule</mat-icon>
                <div class="mini-stat-text">
                  <span>{{ stat.day }}</span>
                  <strong>{{ stat.hours }}h</strong>
                </div>
              </div>
            }
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
